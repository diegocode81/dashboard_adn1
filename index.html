<form id="f" method="post" action="/api/upload" enctype="multipart/form-data">
  <input type="file" name="file" accept=".csv" required />
  <button type="submit">Subir y cargar</button>
</form>
<pre id="out"></pre>
<script>
  const f = document.getElementById('f');
  const out = document.getElementById('out');
  f.addEventListener('submit', async (e) => {
    e.preventDefault();
    out.textContent = 'Subiendo...';
    const fd = new FormData(f);
    const r = await fetch('/api/upload', { method: 'POST', body: fd });
    const ct = r.headers.get('content-type') || '';
    const data = ct.includes('application/json') ? await r.json() : { error: await r.text() };
    out.textContent = JSON.stringify(data, null, 2);
  });
</script>
